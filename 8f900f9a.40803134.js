/*! For license information please see 8f900f9a.40803134.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{101:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return s})),n.d(t,"rightToc",(function(){return b})),n.d(t,"default",(function(){return p}));var a=n(1),c=n(6),o=(n(0),n(112)),r=n(131),l=n(132),i={id:"core",title:"Core Package",sidebar_label:"Core",keywords:["InstantHIE","Core","Package"],description:"The core package of the InstantHIE"},s={id:"packages/core",title:"Core Package",description:"The core package of the InstantHIE",source:"@site/docs/packages/core.md",permalink:"/instant/docs/packages/core",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/packages/core.md",sidebar_label:"Core",sidebar:"docs",previous:{title:"Overview of Packages",permalink:"/instant/docs/packages/overview"},next:{title:"Health-Workforce",permalink:"/instant/docs/packages/health-workforce"}},b=[{value:"Getting Started",id:"getting-started",children:[{value:"Useful compose flags",id:"useful-compose-flags",children:[]},{value:"Environment configuration",id:"environment-configuration",children:[]},{value:"Minikube (local)",id:"minikube-local",children:[]},{value:"Amazon Web Services",id:"amazon-web-services",children:[]},{value:"Google Cloud",id:"google-cloud",children:[]},{value:"Azure",id:"azure",children:[]},{value:"Digital Ocean",id:"digital-ocean",children:[]}]},{value:"Getting Started",id:"getting-started-1",children:[{value:"View running Kubernetes resources",id:"view-running-kubernetes-resources",children:[]}]},{value:"Initial OpenHIM Config",id:"initial-openhim-config",children:[]},{value:"Development mode for exposed services",id:"development-mode-for-exposed-services",children:[]},{value:"Accessing the services",id:"accessing-the-services",children:[]},{value:"Testing the Core package",id:"testing-the-core-package",children:[]}],u={rightToc:b};function p(e){var t=e.components,n=Object(c.a)(e,["components"]);return Object(o.b)("wrapper",Object(a.a)({},u,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"The InstantHIE Core Package is the base of the InstantHIE architecture."),Object(o.b)("p",null,"This package consists of two components:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Interoperability Layer - ",Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"http://openhim.org/"}),"OpenHIM")),Object(o.b)("li",{parentName:"ul"},"FHIR Server - ",Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"https://hapifhir.io/"}),"HAPI FHIR"))),Object(o.b)("h2",{id:"getting-started"},"Getting Started"),Object(o.b)("p",null,"Select a deployment platform below to follow the getting started steps in setting up this package."),Object(o.b)(r.a,{defaultValue:"dockerCompose",values:[{label:"Docker Compose",value:"dockerCompose"},{label:"Kubernetes",value:"kubernetes"}],mdxType:"Tabs"},Object(o.b)(l.a,{value:"dockerCompose",mdxType:"TabItem"},Object(o.b)("p",null,"Before we proceed with creating our Core package components, we need to ensure we are in the correct directory containing our ",Object(o.b)("inlineCode",{parentName:"p"},"docker-compose")," script."),Object(o.b)("p",null,"Once you are in the correct working directory (",Object(o.b)("inlineCode",{parentName:"p"},"core/docker/"),") we can proceed to execute our ",Object(o.b)("inlineCode",{parentName:"p"},"docker-compose")," script by running the below command which will create all the services and print out their logs in the terminal."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"docker-compose up\n")),Object(o.b)("h3",{id:"useful-compose-flags"},"Useful compose flags"),Object(o.b)("p",null,"Some additional flags can be passed to the ",Object(o.b)("inlineCode",{parentName:"p"},"docker-compose")," command making it a bit easier to work with."),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"-d"),": Run the services in a detached mode. This means that when you close or exit your terminal, the services will still be running in the background."),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"-f"),": Specify the location of the ",Object(o.b)("inlineCode",{parentName:"li"},"docker-compose")," file to be executed. Omitting this flag will look for the default ",Object(o.b)("inlineCode",{parentName:"li"},"docker-compose.yml")," file."),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"--force-recreate"),": This will force the container/image to be re-created if a newer version is found. This is useful when a new image has been released but not yet pulled onto the host machine.")),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"docker-compose up -d --force-recreate\n")),Object(o.b)("h3",{id:"environment-configuration"},"Environment configuration"),Object(o.b)("p",null,"By running the above command to get started with the Core package we create all the services that need to be defined, but this script might have some limitations depending on the type of environment you want to run the configuration"),Object(o.b)("p",null,"Additional ",Object(o.b)("inlineCode",{parentName:"p"},"docker-compose")," files are available for extra environment configuration"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("strong",{parentName:"li"},"docker-compose.yml"),": Main ",Object(o.b)("inlineCode",{parentName:"li"},"docker-compose")," script to create the services"),Object(o.b)("li",{parentName:"ul"},Object(o.b)("strong",{parentName:"li"},"docker-compose.dev.yml"),": Development ",Object(o.b)("inlineCode",{parentName:"li"},"docker-compose")," script to override some of the default configurations to be used in a development environment (Open service ports for access etc)")),Object(o.b)("p",null,"The below command specifies the three ",Object(o.b)("inlineCode",{parentName:"p"},"docker-compose")," files that need to be executed for the development configuration"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"docker-compose -f docker-compose.yml -f docker-compose.dev.yml -f docker-compose.config.yml up -d\n")),Object(o.b)("p",null,"The below command specifies the two ",Object(o.b)("inlineCode",{parentName:"p"},"docker-compose")," files that need to be executed for a production-like configuration"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"docker-compose -f docker-compose.yml -f docker-compose.config.yml up -d\n"))),Object(o.b)(l.a,{value:"kubernetes",mdxType:"TabItem"},Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"If you are working with multiple cluster hosting clients you may need to switch cluster context for your deployment. See the below commands:")),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-sh"}),"kubectl config get-contexts\nkubectl config use-context <context-name>\n")),Object(o.b)("h3",{id:"minikube-local"},"Minikube (local)"),Object(o.b)("p",null,"For the Kubernetes deployment to work as expected, we need to ensure we have ",Object(o.b)("inlineCode",{parentName:"p"},"minikube")," installed on our local machine running the deployment. Follow these steps to ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://kubernetes.io/docs/tasks/tools/install-minikube/"}),"install minikube")),Object(o.b)("p",null,"Once installed, we can start the minikube service by executing the below command:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-sh"}),"minikube start --cpus 4 --memory 8192\n")),Object(o.b)("p",null,"This also updates the VM settings to make use of 4 CPU's and 8GB of RAM, instead of the default 2 CPU's and 4GB of RAM"),Object(o.b)("h3",{id:"amazon-web-services"},"Amazon Web Services"),Object(o.b)("p",null,"Useful links:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html"}),"AWS Cli Setup guide")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"https://docs.aws.amazon.com/eks/latest/userguide/getting-started-console.html"}),"Amazon Elastic Kubernetes Service(EKS) Quickstart"))),Object(o.b)("h4",{id:"install-aws-cli"},"Install AWS Cli"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-sh"}),'curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"\n\nunzip awscliv2.zip\n\nsudo ./aws/install\n')),Object(o.b)("h3",{id:"google-cloud"},"Google Cloud"),Object(o.b)("p",null,"Useful Links:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"https://cloud.google.com/sdk/docs#deb"}),"Google Cloud Cli Setup Guide")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"https://cloud.google.com/kubernetes-engine/docs/how-to/cluster-access-for-kubectl"}),"Google Cloud Cluster Quickstart"))),Object(o.b)("h3",{id:"azure"},"Azure"),Object(o.b)("p",null,"Useful Links:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"https://docs.microsoft.com/en-us/cli/azure/install-azure-cli-apt?view=azure-cli-latest"}),"Azure Cli Setup Guide")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"https://docs.microsoft.com/en-us/cli/azure/aks?view=azure-cli-latest"}),"Quickstart"))),Object(o.b)("h4",{id:"install-azure-cli"},"Install Azure Cli"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-sh"}),"curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash\n\naz login\n")),Object(o.b)("h3",{id:"digital-ocean"},"Digital Ocean"),Object(o.b)("p",null,"Useful Links:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"https://www.digitalocean.com/docs/kubernetes/how-to/connect-to-cluster/"}),"Digital Ocean Cli Setup Guide"))),Object(o.b)("h4",{id:"install-digital-ocean-ctl"},"Install Digital Ocean Ctl"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-sh"}),"curl -OL https://github.com/digitalocean/doctl/releases/download/v<version>/doctl-<version>-linux-amd64.tar.gz\n\nsudo mv ./doctl /usr/local/bin\n")),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/digitalocean/doctl/releases"}),"See here for latest version"))),Object(o.b)("hr",null),Object(o.b)("h2",{id:"getting-started-1"},"Getting Started"),Object(o.b)("p",null,"Useful Links:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"https://www.digitalocean.com/community/cheatsheets/getting-started-with-kubernetes-a-kubectl-cheat-sheet"}),"Kubectl Cheat Sheet"))),Object(o.b)("p",null,"Before we proceed with creating our ",Object(o.b)("inlineCode",{parentName:"p"},"Core Package")," services, we need to ensure we are in the correct directory containing our bash setup scripts."),Object(o.b)("p",null,"Once you are in the correct working directory (",Object(o.b)("inlineCode",{parentName:"p"},"core/kubernetes"),") we can proceed to create our core instant ohie deployment with the following command:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"./main/k8s.sh up\n")),Object(o.b)("p",null,"The OpenHIM console url will be displayed in the terminal output when the script completes. The Url may take a few minutes to become active as the pod may not be fully initialized yet."),Object(o.b)("p",null,"This bash script will apply the kubernetes ",Object(o.b)("inlineCode",{parentName:"p"},"kustomization.yaml")," file which controls the ",Object(o.b)("inlineCode",{parentName:"p"},"Core Package")," components (ie: OpenHIM and HAPI-FHIR)."),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"On first run the setup may take up to 10 minutes as the Docker images for each component will need to be pulled. This won't happen on future runs.")),Object(o.b)("h3",{id:"view-running-kubernetes-resources"},"View running Kubernetes resources"),Object(o.b)("p",null,"Execute the below commands to see the running Kubernetes resources and the state that they are in."),Object(o.b)("p",null,"To display all resource: (Some new resources are not listed here)"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-sh"}),"kubectl get all --all-namespaces\n")),Object(o.b)("p",null,"To tear down this deployment use the opposing command:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"./main/k8s.sh down\n")),Object(o.b)("p",null,"To completely remove all project components use the following option:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"./main/k8s.sh destroy\n")),Object(o.b)("hr",null),Object(o.b)("h2",{id:"initial-openhim-config"},"Initial OpenHIM Config"),Object(o.b)("p",null,"We have included a useful set of scripts to initialize the OpenHIM and set it up to communicate with the HAPI-FHIR server. This will change the default user's password of the OpenHIM to ",Object(o.b)("inlineCode",{parentName:"p"},"instant101"),", and create a channel configured to route traffic to the HAPI-FHIR instance. From the ",Object(o.b)("inlineCode",{parentName:"p"},"kubernetes")," directory, use the following command to implement:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"./importer/k8s.sh up\n")),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"These scripts can be duplicated and modified to implement custom imports")),Object(o.b)("p",null,"To clean up the remaining job and pods from a successful setup, run the following:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"./importer/k8s.sh clean\n")),Object(o.b)("p",null,"Once the config is done HAPI FHIR will be accessible on: ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://OPENHIM_CORE_HOSTNAME/hapi-fhir-jpaserver/fhir/"}),"https://OPENHIM_CORE_HOSTNAME/hapi-fhir-jpaserver/fhir/")),Object(o.b)("p",null,"You may test that the OpenHIM is routing requests to HAPI FHIR by running:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"./test.sh <OPENHIM_CORE_HOSTNAME>\n")),Object(o.b)("hr",null),Object(o.b)("h2",{id:"development-mode-for-exposed-services"},"Development mode for exposed services"),Object(o.b)("p",null,"To run in development mode, where the OpenHIM mongo database, HAPI FHIR server, and the MySQL database can be accessed directly through their urls, run the following command"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"./dev/k8s.dev.sh\n")),Object(o.b)("hr",null))),Object(o.b)("h2",{id:"accessing-the-services"},"Accessing the services"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("strong",{parentName:"li"},"OpenHIM"),Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},"Console: Displayed in the output of the startup script"),Object(o.b)("li",{parentName:"ul"},"Username: ",Object(o.b)("strong",{parentName:"li"},"root@openhim.org")),Object(o.b)("li",{parentName:"ul"},"Password: ",Object(o.b)("strong",{parentName:"li"},"instant101")))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("strong",{parentName:"li"},"HAPI FHIR"),Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},"This service should not be publicly accessible and only accessed via the Interoperability Layer")))),Object(o.b)("h2",{id:"testing-the-core-package"},"Testing the Core package"),Object(o.b)("p",null,"As part of the Core package setup, we also do some initial imports of config for connecting the services."),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"OpenHIM: Import a public channel configuration that routes requests to the HAPI FHIR services"),Object(o.b)("li",{parentName:"ul"},"HAPI FHIR: ",Object(o.b)("em",{parentName:"li"},"Not config import yet"))),Object(o.b)("p",null,"For testing this Core package we will be making use of ",Object(o.b)("inlineCode",{parentName:"p"},"curl")," for sending our request, but any client could be used to achieve the same result."),Object(o.b)("p",null,"Execute the below ",Object(o.b)("inlineCode",{parentName:"p"},"curl")," request to successfully route a request through the OpenHIM to query the HAPI FHIR server."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"curl <openhim_core_transaction_api_url>/hapi-fhir-jpaserver/fhir/Patient\n")),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"The ",Object(o.b)("strong",{parentName:"p"},"openhim_core_transaction_api_url")," is displayed in the output of the startup script")))}p.isMDXComponent=!0},110:function(e,t,n){var a;!function(){"use strict";var n={}.hasOwnProperty;function c(){for(var e=[],t=0;t<arguments.length;t++){var a=arguments[t];if(a){var o=typeof a;if("string"===o||"number"===o)e.push(a);else if(Array.isArray(a)&&a.length){var r=c.apply(null,a);r&&e.push(r)}else if("object"===o)for(var l in a)n.call(a,l)&&a[l]&&e.push(l)}}return e.join(" ")}e.exports?(c.default=c,e.exports=c):void 0===(a=function(){return c}.apply(t,[]))||(e.exports=a)}()},112:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return d}));var a=n(0),c=n.n(a);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,c=function(e,t){if(null==e)return{};var n,a,c={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(c[n]=e[n]);return c}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(c[n]=e[n])}return c}var s=c.a.createContext({}),b=function(e){var t=c.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l({},t,{},e)),n},u=function(e){var t=b(e.components);return c.a.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return c.a.createElement(c.a.Fragment,{},t)}},m=Object(a.forwardRef)((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,r=e.parentName,s=i(e,["components","mdxType","originalType","parentName"]),u=b(n),m=a,d=u["".concat(r,".").concat(m)]||u[m]||p[m]||o;return n?c.a.createElement(d,l({ref:t},s,{components:n})):c.a.createElement(d,l({ref:t},s))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,r=new Array(o);r[0]=m;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l.mdxType="string"==typeof e?e:a,r[1]=l;for(var s=2;s<o;s++)r[s]=n[s];return c.a.createElement.apply(null,r)}return c.a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},131:function(e,t,n){"use strict";var a=n(0),c=n.n(a),o=n(110),r=n.n(o),l=n(88),i=n.n(l);const s=37,b=39;t.a=function(e){const{block:t,children:n,defaultValue:o,values:l}=e,[u,p]=Object(a.useState)(o),m=[];return c.a.createElement("div",null,c.a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:r()("tabs",{"tabs--block":t})},l.map(({value:e,label:t})=>c.a.createElement("li",{role:"tab",tabIndex:"0","aria-selected":u===e,className:r()("tab-item",i.a.tabItem,{"tab-item--active":u===e}),key:e,ref:e=>m.push(e),onKeyDown:e=>((e,t,n)=>{switch(n.keyCode){case b:((e,t)=>{const n=e.indexOf(t)+1;e[n]?e[n].focus():e[0].focus()})(e,t);break;case s:((e,t)=>{const n=e.indexOf(t)-1;e[n]?e[n].focus():e[e.length-1].focus()})(e,t)}})(m,e.target,e),onFocus:()=>p(e),onClick:()=>p(e)},t))),c.a.createElement("div",{role:"tabpanel",className:"margin-vert--md"},a.Children.toArray(n).filter(e=>e.props.value===u)[0]))}},132:function(e,t,n){"use strict";var a=n(0),c=n.n(a);t.a=function(e){return c.a.createElement("div",null,e.children)}}}]);