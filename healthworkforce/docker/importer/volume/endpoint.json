{
  "name": "mCSD Orchestration",
  "endpoint": {
    "pattern": "/mcsd"
  },
  "transformation": {
    "input": "JSON",
    "output": "JSON"
  },
  "requests": {
    "lookup": [
      {
        "id": "gofr-location",
        "config": {
          "method": "get",
          "url": "http://mock-services:4000/gofr-location-mock/_history",
          "headers": {
            "Content-Type": "application/json"
          },
          "params": {
            "_since": {
              "path": "state.system.timestamps.lookupRequests.gofr-location.requestStart",
              "prefix": null,
              "postfix": null
            }
          }
        }
      },
      {
        "id": "gofr-organization",
        "config": {
          "method": "get",
          "url": "http://mock-services:4000/gofr-organization-mock/_history",
          "headers": {
            "Content-Type": "application/json"
          },
          "params": {
            "_since": {
              "path": "state.system.timestamps.lookupRequests.gofr-organization.requestStart",
              "prefix": null,
              "postfix": null  
            }
          }
        }
      },
      {
        "id": "ihris-practitioner",
        "config": {
          "method": "get",
          "url": "http://mock-services:4000/ihris-practitioner-mock/_history",
          "headers": {
            "Content-Type": "application/json"
          },
          "params": {
            "_since": {
              "path": "state.system.timestamps.lookupRequests.ihris-practitioner.requestStart",
              "prefix": null,
              "postfix": null  
            }
          }
        }
      },
      {
        "id": "ihris-practitionerRole",
        "config": {
          "method": "get",
          "url": "http://mock-services:4000/ihris-practitionerRole-mock/_history",
          "headers": {
            "Content-Type": "application/json"
          },
          "params": {
            "_since": {
              "path": "state.system.timestamps.lookupRequests.ihris-practitionerRole.requestStart",
              "prefix": null,
              "postfix": null  
            }
          }
        }
      }
    ],
    "response": [
      {
        "id": "fhir",
        "config": {
          "method": "post",
          "url": "http://mock-services:4000/fhir-mock",
          "headers": {
            "Content-Type": "application/json"
          }
        }
      }
    ]
  },
  "inputValidation": {
    "type": "object",
    "properties": {
      "lookupRequests": {
        "type": "object",
        "properties": {
          "gofr-location": {
            "type": "object",
            "properties": {
              "resourceType": {"type": "string"},
              "type": {"type": "string"},
              "entry": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "fullUrl": {"type": "string"},
                    "resource": {
                      "type": "object",
                      "properties": {
                        "resourceType": {"type": "string"},
                        "id": {"type": "string"}
                      }
                    }
                  }
                }
              }
            },
            "required": ["entry", "type", "resourceType"]
          },
          "gofr-organization": {
            "type": "object",
            "properties": {
              "resourceType": {"type": "string"},
              "type": {"type": "string"},
              "entry": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "fullUrl": {"type": "string"},
                    "resource": {
                      "type": "object",
                      "properties": {
                        "resourceType": {"type": "string"},
                        "id": {"type": "string"}
                      },
                      "required": ["resourceType"]
                    }
                  }
                }
              }
            },
            "required": ["entry", "type", "resourceType"]
          },
          "ihris-practitioner": {
            "type": "object",
            "properties": {
              "resourceType": {"type": "string"},
              "type": {"type": "string"},
              "entry": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "fullUrl": {"type": "string"},
                    "resource": {
                      "type": "object",
                      "properties": {
                        "resourceType": {"type": "string"},
                        "id": {"type": "string"}
                      },
                      "required": ["resourceType"]
                    }
                  }
                }
              }
            },
            "required": ["entry", "type", "resourceType"]
          },
          "ihris-practitionerRole": {
            "type": "object",
            "properties": {
              "resourceType": {"type": "string"},
              "type": {"type": "string"},
              "entry": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "fullUrl": {"type": "string"},
                    "resource": {
                      "type": "object",
                      "properties": {
                        "resourceType": {"type": "string"},
                        "id": {"type": "string"},
                        "code": {
                          "type": "array",
                          "items":{
                            "coding": {
                              "type": "array",
                              "items": {
                                "system": {"type": "string"},
                                "code": {"type": "string"}
                              }
                            }
                          }
                        }
                      },
                      "required": ["resourceType"]
                    }
                  },
                  "required": ["resource"]
                }
              }
            },
            "required": ["entry", "type", "resourceType"]
          }
        },
        "required": ["gofr-location", "gofr-organization", "ihris-practitioner", "ihris-practitionerRole"]
      }
    }
  },
  "inputMapping": {
    "lookupRequests.gofr-location.entry[]": {
      "key": "entry[]+",
      "transform": "appendArray"
    },
    "lookupRequests.gofr-organization.entry[]": {
      "key": "entry[]+",
      "transform": "appendArray"
    },
    "lookupRequests.ihris-practitioner.entry[]": {
      "key": "entry[]+",
      "transform": "appendArray"
    },
    "lookupRequests.ihris-practitionerRole.entry[]": {
      "key": "entry[]+",
      "transform": "appendArray"
    }
  },
  "state": {
    "extract": {
      "system": {
        "timestamps": true
      }
    }
  },
  "constants": {
    "resourceType": "Bundle",
    "type": "transaction"
  }
}
